---
import { AstroFont } from "astro-font";
import theme from "@/config/theme.json";
const { head } = Astro.locals.starlightRoute;

// font families
const pf = theme.fonts.font_family.primary;
// @ts-ignore
const sf = theme.fonts.font_family.secondary ;

let fontPrimary, fontSecondary;
if (theme.fonts.font_family.primary) {
  fontPrimary = theme.fonts.font_family.primary
    .replace(/\+/g, " ")
    .replace(/:[ital,]*[ital@]*[wght@]*[0-9,;.]+/gi, "");
}
// @ts-ignore
if (theme.fonts.font_family.secondary) {
// @ts-ignore
  fontSecondary = theme.fonts.font_family.secondary
    .replace(/\+/g, " ")
    .replace(/:[ital,]*[ital@]*[wght@]*[0-9,;.]+/gi, "");
}

---

{head.map(({ tag: Tag, attrs, content }) => {
  // Replace Starlight's default favicon with Grimnir's image
  if (Tag === 'link' && attrs && (attrs.rel === 'shortcut icon' || attrs.rel === 'icon')) {
    return (
      <>
        <link rel="icon" type="image/jpeg" href="/grimnir/charicons/grimnir.jpg" />
        <link rel="shortcut icon" type="image/jpeg" href="/grimnir/charicons/grimnir.jpg" />
      </>
    );
  }
  return <Tag {...attrs} set:html={content} />
})}

<link rel="apple-touch-icon" href="/grimnir/charicons/grimnir.jpg" />

<script is:inline>
  // Set default theme to dark if not already set
  if (!document.documentElement.dataset.theme) {
    const savedTheme = localStorage.getItem("starlight-theme");
    if (savedTheme === "light") {
      document.documentElement.dataset.theme = "light";
    } else {
      document.documentElement.dataset.theme = "dark";
      if (!savedTheme) {
        localStorage.setItem("starlight-theme", "dark");
      }
    }
  }
</script>

<!-- google font css -->
    <AstroFont
      config={[
        {
          src: [],
          preload: false,
          display: "swap",
          name: fontPrimary!,
          fallback: "sans-serif",
          cssVariable: "font-primary",
          googleFontsURL: `https://fonts.googleapis.com/css2?family=${pf}&display=swap`,
        },
        {
          src: [],
          preload: false,
          display: "swap",
          name: fontSecondary!,
          fallback: "sans-serif",
          cssVariable: "font-secondary",
          googleFontsURL: `https://fonts.googleapis.com/css2?family=${sf}&display=swap`,
        },
      ]}
    />

